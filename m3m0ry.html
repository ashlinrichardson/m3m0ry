<html><body>
<canvas></canvas>
<script src="util.js"></script>
<script src="state.js"></script>
<script src="wrap_text.js"></script>
<script src="egg_timer.js"></script>
<script src="key_board.js"></script>
<script>
  //console.log('dont forget to set random seed.'); // want same results every time.
  //console.log('dont forget to filter keys.'); //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
//does user enter a code? do they have to copy a result file?
// random sample doesn't change on revisit.
 
  // somewhere to put the history (print it out at the end? or send it with AJAX?)
  // probably put up a python cgi hook to store the results. 
  var history = []; 

  // graphics ctx
  var canvas = document.getElementsByTagName("canvas")[0];
  var ctx = canvas.getContext("2d"); 
  document.bgColor = "#FFFFFF"; 

  // padded window dimensions
  ctx.pad = 20; 
  var less = function(x){ return x - ctx.pad; }
  ctx.w = function(){ return less(window.innerWidth); }
  ctx.h = function(){  return less(window.innerHeight); }  
  
  // logo scaling algorithm
  ctx.symbol = load_img("logo/uvic_gray.png");
  ctx.draw_symbol = function(){
    var s_f = 5;
    var pad = this.pad;
    var s = this.symbol;
    var ww = window.innerWidth; 
    var wh = window.innerHeight;
    var w = ww - pad; var h = wh - pad; 
    var w_s = s.width; var h_s = s.height;
    var wf = (ww - pad) / (s_f * w_s);
    var lwf = w_s * wf; var lhf = h_s * wf; 
    this.drawImage(s, w - lwf, h - lhf, lwf, lhf);
  };

  // access current state.
  ctx.set_state = function(s){ ctx.current_state = s; return(s); };
  ctx.state = function(){ return ctx.current_state; };

  ctx.egg_timer = egg_timer;
  ctx.clear_tmr = function(){
    ctx.egg_timer.cancel();
  };
  ctx.init_tmr = function(t_ms, callback){
    ctx.egg_timer.setup(t_ms, callback);
  };
    
  var n_imgs = 10; //200;
  var imgs = new Array(); 
   
  // should only load the used ones..
  for(var i=1; i <= n_imgs; i++)
    imgs.push(load_img('images/' + i + '.jpg'));

  // event example hello world
  ctx.set_state(state(ctx));
  ctx.state().set_expiry(777);
  //ctx.state().key_expiry =false;
  ctx.state().start();
  
  // turn on kb hook... kb event handler
  function kb_call(kb_map, unicode_map){ 
    var now = ctx.state();
    if(now && now.key_expiry){
        ctx.clear_tmr();
        now.expire();
    }
  }

  kb_map, unicode_map = keyboard_module(kb_call);
  ctx.t0 = window.performance.now(); 

  function resize(){ 
    canvas.width = ctx.w(); 
    canvas.height = ctx.h(); 
  }
  function update() { 
    resize(); 
    var now = ctx.state();
    if(now) 
      now.show();
  }
  
  window.onresize = function(event){ update(); }; // any other possibilities?
  
  // seems to be this is the `in' hook..
  window.onload = function(){
    //set up all the events in a chain... 
    update();
  }
</script>
</body></html>

